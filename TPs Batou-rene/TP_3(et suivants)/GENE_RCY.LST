MACRO ASSEMBLER GENE_RCY                                    11/22/19 17:21:40 PAGE     1


WIN32 MACRO ASSEMBLER MA51 V06.04.19OBJECT MODULE PLACED IN C:\TP\PHY4501\TP\TP_3\GENE_RCY.OBJ
ASSEMBLER INVOKED BY: MA51.EXE C:\TP\PHY4501\TP\TP_3\GENE_RCY.A51 OJ(C:\TP\PHY4501\TP\TP_3\GENE_RCY.OBJ) PIN(C:\RIDE\INC;C:\RIDE\INC\51) PIN(C:\RIDE\INC\51\) EP LINES SYNTAX(ASM51) MOD51 PR(C:\TP\PHY4501\TP\TP_3\GENE_RCY.LST) XR DB PW(80) RB(0) 

LOC     OBJ           LINE    SOURCE
                         1     ;Gene_Rcy
                         2     ;Created by Lamiaux Rémy and Ghirardi Baptiste
                         3     ;20/11/2019
                         4     ;version 1
                         5     
                         6     ;V1: précharge du compteur à l'état haut
  00FF                   7     V1_INIT_H   EQU 			0FFH
  0042                   8     V1_INIT_L   EQU 			038H+0AH				;V0_Init_L = N_L + Nr
                         9     ;V0: précharge du compteur à l'état bas
  00FC                  10     V0_INIT_H   EQU 			0FCH
  00EA                  11     V0_INIT_L   EQU 			0E0H+0AH
  0014                  12     PAS			EQU			20
                        13     ;Ressources de la routine Attente
  003C                  14     CHARGE_H	   EQU 			03CH
  00B8                  15     CHARGE_L	   EQU 			0B0H+08H				;Charge_L = N_L + Nr	
                        16     
  007D                  17     V1_L			DATA			7DH
  007C                  18     V1_H			DATA			7CH
  007F                  19     V0_L			DATA			7FH
  007E                  20     V0_H			DATA			7EH
                        21     				
  0000                  22     ETAPE			BIT			0B
                        23     
  0090                  24     DOWN			BIT			P1.0 
  0091                  25     UP				BIT			P1.1
  00B0                  26     GENE			BIT			P3.0
  00D5                  27     MODIF			BIT			F0						;modification autorisée si MODIF à 1
                        28     
                        29     ;Table des vecteurs d'IT
  0000                  30        			ORG			0000H
0000    802E            31     				SJMP			DEBUT
                        32     				
  000B                  33     				ORG			000BH
000B    0200C1          34     				LJMP			INT_TIMER0
                        35     				
  0030                  36     				ORG			0030H
                        37     
                        38     ;________________________________________________________	
                        39     ;Programme Principal   			
                        40     DEBUT:  				
0030    120081          41     				LCALL			INIT
                        42     RPT: 
                        43     
0033    30003C          44     SI: 			JNB			ETAPE,FSI_DOWN
0036    30911B          45     SI_UP: 		JNB			UP,FSI_UP
                        46     				
0039    E57D            47     				MOV			A,V1_L
003B    C3              48     				CLR			C
003C    9414            49     SUBB A , # 20 
003E    F57D            50     				MOV			V1_L,A
0040    E57C            51     				MOV			A,V1_H
0042    9400            52     				SUBB			A,#0
0044    F57C            53     				MOV			V1_H,A
                        54     				
0046    E57F            55     				MOV			A,V0_L
0048    2414            56     ADD A , # 20 
004A    F57F            57     				MOV			V0_L,A
004C    E57E            58     				MOV			A,V0_H
004E    3400            59     				ADDC			A,#0
0050    F57E            60     				MOV			V0_H,A
                        61     				
0052    D2D5            62     				SETB			MODIF
                        63     FSI_UP: 
                        64     
0054    30901B          65     SI_DOWN: 		JNB			DOWN,FSI_DOWN
                        66     			
0057    E57F            67     				MOV			A,V0_L
0059    C3              68     				CLR			C
005A    9414            69     SUBB A , # 20 
005C    F57F            70     				MOV			V0_L,A
005E    E57E            71     				MOV			A,V0_H
0060    9400            72     				SUBB			A,#0
0062    F57E            73     				MOV			V0_H,A
                        74     				
0064    E57D            75     				MOV			A,V1_L
0066    2414            76     ADD A , # 20 
0068    F57D            77     				MOV			V1_L,A
006A    E57C            78     				MOV			A,V1_H
006C    3400            79     				ADDC			A,#0
006E    F57C            80     				MOV			V1_H,A
                        81     				
0070    D2D5            82     				SETB			MODIF
                        83     FSI_DOWN: 
                        84     
0072    30D50A          85     SI_MODIF: 	JNB			MODIF,FSI_MODIF		;condition vérifiée si MODIF vaut 1
0075    7414            86     				MOV			A,#20
0077    1200A7          87     BOUCLE_X20:  LCALL       ATTENTE
007A    14              88     				DEC			A
007B    70FA            89     				JNZ			BOUCLE_X20
                        90     FIN_BOUCLE_X20: 
007D    C2D5            91     				CLR			MODIF
                        92     FSI_MODIF: 
                        93     
                        94     				
007F    80B2            95     JSQ: 			SJMP			RPT
                        96     
                        97     FIN: 
                        98     
                        99     
                       100     ;________________________________________________________	
                       101     ;Routine d'initialisation
                       102     INIT: 
0081    75810F         103     				MOV			SP,#0FH
0084    758911         104     		      MOV			TMOD,#011H
0087    75A882         105     		      MOV			IE,#10000010B
008A    C2D5           106     		      CLR			MODIF
                       107     		      
                       108     		      ;Initialisation des valeurs de précharge du timer
008C    757FEA         109     MOV V0_L , # 234 
008F    757EFC         110     MOV V0_H , # 252 
0092    757D42         111     MOV V1_L , # 66 
0095    757CFF         112     MOV V1_H , # 255 
                       113     		      
                       114     		      ;On commence par l'étape 1, pour laquelle Gene est à 0
0098    C2B0           115     		      CLR			GENE
009A    C200           116     		      CLR			ETAPE
                       117     		      
                       118     		      ;Initialisation et démarrage du timer0		
009C    758AEA         119     MOV TL0 , # 234 
009F    758CFC         120     MOV TH0 , # 252 
00A2    C28D           121     		      CLR			TF0					
00A4    D28C           122     		      SETB			TR0	
00A6    22             123     FIN_INIT: 	RET
                       124     
                       125     
                       126     
                       127     ;________________________________________________________				
                       128     ;Routine d'attente de 50ms			
                       129     ATTENTE:  
00A7    C0E0           130     				PUSH			ACC		
                       131     DEBUT_ATTENTE:  	      
00A9    C28E           132     				CLR			TR1
00AB    E58B           133     				MOV			A,TL1					;1CM
00AD    24B8           134     ADD A , # 184 
00AF    F58B           135     		      MOV			TL1,A					;1CM
00B1    E58D           136     		      MOV			A,TH1					;1CM
00B3    343C           137     ADDC A , # 60 
00B5    F58D           138     		      MOV			TH1,A					;1CM
00B7    C28F           139     		      CLR			TF1					;1CM
00B9    D28E           140     		      SETB			TR1					;1CM
00BB    308FFD         141     ATTENDRE: 	JNB			TF1,ATTENDRE								
00BE    D0E0           142     				POP			ACC
00C0    22             143     FIN_ATTENTE: RET
                       144     
                       145     ;Routine d'interruption du Timer 0
                       146     INT_TIMER0:  
00C1    30000A         147     SI_T0: 		JNB	      ETAPE,SINON_T0
00C4    A87F           148     				MOV			R0,V0_L
00C6    A97E           149     		      MOV			R1,V0_H
00C8    C200           150     		      CLR			ETAPE
00CA    C2B0           151     		      CLR			GENE
00CC    8008           152     FIN_SI_T0: 	SJMP			FIN_SINON_T0      
                       153     SINON_T0: 
00CE    A87D           154     		      MOV			R0,V1_L
00D0    A97C           155     		      MOV			R1,V1_H
00D2    D200           156     		      SETB			ETAPE
00D4    D2B0           157     		      SETB			GENE
                       158     FIN_SINON_T0: 				
00D6    C0E0           159     				PUSH			ACC				
00D8    C28C           160     				CLR			TR0					
00DA    E58A           161     				MOV			A,TL0					;1CM
00DC    28             162     				ADD			A,R0					;1CM
00DD    F58A           163     		      MOV			TL0,A					;1CM
00DF    E58C           164     		      MOV			A,TH0					;1CM
00E1    39             165     		      ADDC			A,R1					;1CM
00E2    F58C           166     		      MOV			TH0,A					;1CM
00E4    C28D           167     		      CLR			TF0					;1CM
00E6    D0E0           168     		      POP			ACC					;2CM
00E8    D28C           169     		      SETB			TR0					;1CM
                       170     FIN_INT_TIMER0: 	
00EA    32             171     				RETI
                       172     				
                       173     				END
MACRO ASSEMBLER GENE_RCY                                    11/22/19 17:21:40 PAGE     0


SYMBOL TABLE LISTING
------ ----- -------


N A M E             T Y P E  V A L U E   ATTRIBUTES             REFERENCES

SI_UP. . . . . . .  C ADDR   0036H   A                          45# 
V0_INIT_H. . . . .  N NUMB   00FCh                              10# 110 120 
V1_INIT_H. . . . .  N NUMB   00FFh                              7# 112 
P1 . . . . . . . .  D ADDR   0090H   A                          24 25 
P3 . . . . . . . .  D ADDR   00B0H   A                          26 
SP . . . . . . . .  D ADDR   0081H   A                          103 
PAS. . . . . . . .  N NUMB   0014h                              12# 49 56 69 76 
V0_INIT_L. . . . .  N NUMB   00EAh                              11# 109 119 
UP . . . . . . . .  B ADDR   0090H.1 A                          25# 45 
V1_INIT_L. . . . .  N NUMB   0042h                              8# 111 
FIN_SINON_T0 . . .  C ADDR   00D6H   A                          152 158# 
FSI_UP . . . . . .  C ADDR   0054H   A                          45 63# 
ACC. . . . . . . .  D ADDR   00E0H   A                          130 142 159 168 
DEBUT_ATTENTE. . .  C ADDR   00A9H   A                          131# 
SINON_T0 . . . . .  C ADDR   00CEH   A                          147 153# 
SI_MODIF . . . . .  C ADDR   0072H   A                          85# 
TF0. . . . . . . .  B ADDR   0088H.5 A                          121 167 
TF1. . . . . . . .  B ADDR   0088H.7 A                          139 141 
TH0. . . . . . . .  D ADDR   008CH   A                          120 164 166 
V0_H . . . . . . .  D ADDR   007EH   A                          20# 58 60 71 73 110 
                                                                149 
TH1. . . . . . . .  D ADDR   008DH   A                          136 138 
JSQ. . . . . . . .  C ADDR   007FH   A                          95# 
V1_H . . . . . . .  D ADDR   007CH   A                          18# 51 53 78 80 112 
                                                                155 
IE . . . . . . . .  D ADDR   00A8H   A                          105 
FIN_BOUCLE_X20 . .  C ADDR   007DH   A                          90# 
MODIF. . . . . . .  B ADDR   00D0H.5 A                          27# 62 82 85 91 106 
                                                                
ETAPE. . . . . . .  B ADDR   0020H.0 A                          22# 44 116 147 150 
                                                                156 
FIN_INIT . . . . .  C ADDR   00A6H   A                          123# 
FSI_MODIF. . . . .  C ADDR   007FH   A                          85 92# 
TL0. . . . . . . .  D ADDR   008AH   A                          119 161 163 
FIN_ATTENTE. . . .  C ADDR   00C0H   A                          143# 
V0_L . . . . . . .  D ADDR   007FH   A                          19# 55 57 67 70 109 
                                                                148 
CHARGE_H . . . . .  N NUMB   003Ch                              14# 137 
TL1. . . . . . . .  D ADDR   008BH   A                          133 135 
V1_L . . . . . . .  D ADDR   007DH   A                          17# 47 50 75 77 111 
                                                                154 
BOUCLE_X20 . . . .  C ADDR   0077H   A                          87# 89 
SI_DOWN. . . . . .  C ADDR   0054H   A                          65# 
INIT . . . . . . .  C ADDR   0081H   A                          41 102# 
DEBUT. . . . . . .  C ADDR   0030H   A                          31 40# 
TMOD . . . . . . .  D ADDR   0089H   A                          104 
ATTENTE. . . . . .  C ADDR   00A7H   A                          87 129# 
CHARGE_L . . . . .  N NUMB   00B8h                              15# 134 
RPT. . . . . . . .  C ADDR   0033H   A                          42# 95 
TR0. . . . . . . .  B ADDR   0088H.4 A                          122 160 169 
F0 . . . . . . . .  B ADDR   00D0H.5 A                          27 
FIN_INT_TIMER0 . .  C ADDR   00EAH   A                          170# 
ATTENDRE . . . . .  C ADDR   00BBH   A                          141# 
TR1. . . . . . . .  B ADDR   0088H.6 A                          132 140 
DOWN . . . . . . .  B ADDR   0090H.0 A                          24# 65 
FSI_DOWN . . . . .  C ADDR   0072H   A                          44 65 83# 
FIN_SI_T0. . . . .  C ADDR   00CCH   A                          152# 
INT_TIMER0 . . . .  C ADDR   00C1H   A                          34 146# 
SI . . . . . . . .  C ADDR   0033H   A                          44# 
FIN. . . . . . . .  C ADDR   0081H   A                          97# 
SI_T0. . . . . . .  C ADDR   00C1H   A                          147# 
GENE . . . . . . .  B ADDR   00B0H.0 A                          26# 115 151 157 



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    192    ----
   XDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


REGISTER BANK(S) USED : 0 

ASSEMBLY COMPLETE.   0 WARNING(S)   0 ERROR(S)
