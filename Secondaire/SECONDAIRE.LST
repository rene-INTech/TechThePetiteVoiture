MACRO ASSEMBLER SECONDAIRE                                  12/04/19 19:55:04 PAGE     1


WIN32 MACRO ASSEMBLER MA51 V06.04.19OBJECT MODULE PLACED IN D:\TSP\ISE_PHY4501\TECHTHEPETITEVOITURE\SECONDAIRE\SECONDAIRE.OBJ
ASSEMBLER INVOKED BY: MA51.EXE D:\TSP\ISE_PHY4501\TECHTHEPETITEVOITURE\SECONDAIRE\SECONDAIRE.A51 OJ(D:\TSP\ISE_PHY4501\TECHTHEPETITEVOITURE\SECONDAIRE\SECONDAIRE.OBJ) PIN(D:\RIDE\INC;D:\RIDE\INC\51) PIN(D:\RIDE\INC\51\) EP LINES SYNTAX(ASM51) MOD51 PR(D:\TSP\ISE_PHY4501\TECHTHEPETITEVOITURE\SECONDAIRE\SECONDAIRE.LST) XR DB PW(80) RB(0) 

LOC     OBJ           LINE    SOURCE
                         1      ;Programme du microcontroleur de la carte secondaire
                         2      
                         3      
                         4     ;Déclaration des données
  00A0                   5     LCD				DATA		P2
  00A7                   6     BF					BIT		P2.7
  0085                   7     RS    			BIT		P0.5 
  0086                   8     RW					BIT		P0.6
  0087                   9     E					BIT		P0.7
  0092                  10     LASER				BIT		P1.2
  0093                  11     SIRENE			BIT		P1.3
                        12     
                        13     
                        14     ;Ressources de la routine Attente
  003C                  15     CHARGE_H	    	EQU 	   03CH
  00B8                  16     CHARGE_L	    	EQU 		0B0H+08H		;Charge_L = N_L + Nr	
                        17     
                        18     
                        19     ;Saut de la table des vecteurs d'interruprions
  0000                  20     					ORG		0000H
0000    802E            21     					SJMP		DEBUT
                        22     					
                        23     					
  0030                  24     					ORG		0030H
                        25     DEBUT: 
0030    758125          26     					MOV		SP,#(2FH AND 0A5H)		;La pile se trouve dans la mémoire octets
0033    758921          27     					MOV		TMOD,#21H	;Timer 1 en mode 2 (UART) et timer 0 en mode 1 (Compteur 16 bits)
0036    758DE6          28     					MOV		TH1,#0E6H	;Communication à 1200 Bds
0039    759850          29     					MOV		SCON,#50H	;Communication UART mode 1, réception autorisée, pas de 9e bit
003C    758840          30     					MOV		TCON,#40H	;Démarrage du Timer 1, pas d'interruptions externes
003F    120042          31     					LCALL		LCD_INIT		;Initialisation de l'afficheur LCD
                        32     FIN: 
                        33     
                        34     ;_______________________________________________
                        35     ; Routine d'initialisation du LCD
                        36     ; ressource: R0 compteur (variable locale)
                        37     LCD_INIT: 
0042    7803            38     					MOV		R0,#3
0044    1200B5          39     RPT_LCD_INIT: 	LCALL		ATTENTE			;Répétition 3 fois
0047    C285            40     					CLR		RS
0049    C286            41     					CLR		RW
004B    75A030          42     					MOV		LCD,#30H			;Triple commande d'initialisation
004E    D287            43     					SETB		E
0050    C287            44     					CLR		E
0052    D8F0            45     JSQ_LCD_INIT: 	DJNZ		R0,RPT_LCD_INIT
0054    75A038          46     					MOV		LCD,#38H			;bus 8 bits, Affichage 2 lignes, carractères 8x5
0057    120088          47     					LCALL		LCD_CODE
005A    75A008          48     					MOV		LCD,#08H       ;Display Off, Cursor Off, Blink Off
005D    120088          49     					LCALL		LCD_CODE
0060    75A001          50     					MOV		LCD,#01H       ;Display Clear
0063    120088          51     					LCALL		LCD_CODE
0066    75A006          52     					MOV		LCD,#06H			;Pas de défilement, Ecriture de gauch à droite
0069    120088          53     					LCALL		LCD_CODE
006C    75A00C          54     					MOV		LCD,#0CH       ;Display On, Cursor Off, Blink Off
006F    120088          55     					LCALL		LCD_CODE
0072    22              56     FIN_LCD_INIT: 	RET
                        57     
                        58     ;___________________________________________	
                        59     ;Routine permettant l'envoi d'une chaîne de carractères pointée par DPTR
                        60     LCD_MSG: 
0073    C0E0            61     					PUSH		ACC
0075    7400            62     					MOV		A,#0H
0077    93              63     					MOVC		A,@A+DPTR
0078    600B            64     TQ_MSG: 		   JZ			FTQ_MSG
007A    F5A0            65     					MOV		LCD,A
007C    120094          66     					LCALL		LCD_DATA
007F    A3              67     					INC		DPTR
0080    7400            68     					MOV		A,#0H	
0082    93              69     					MOVC		A,@A+DPTR
0083    80F3            70     					SJMP		TQ_MSG
0085    D0E0            71     FTQ_MSG: 			POP		ACC
0087    22              72     					RET
                        73     											
                        74     ;___________________________________________
                        75     ;Routine d'envoi de donnée (stockée dans le LATCH du port P2) au registre de contrôle du LCD	
                        76     LCD_CODE: 
0088    1200A0          77     					LCALL		LCD_BF
008B    C285            78     					CLR		RS
008D    C286            79     					CLR		RW
008F    D287            80     					SETB		E
0091    C287            81     					CLR		E
0093    22              82     FIN_LCD_CODE: 	RET
                        83     ;___________________________________________
                        84     ;Routine d'envoi de données (stockée dans le LATCH du port P2) au registre d'affichage du LCD	
                        85     LCD_DATA: 
0094    1200A0          86     					LCALL		LCD_BF
0097    D285            87     					SETB		RS
0099    C286            88     					CLR		RW
009B    D287            89     					SETB		E
009D    C287            90     					CLR		E
009F    22              91     FIN_LCD_DATA: 	RET
                        92     ;___________________________________________
                        93     ;Routine d'attente d'état bas sur le Busy FLag du LCD		
                        94     LCD_BF:  
00A0    C0A0            95                   	PUSH		LCD
00A2    75A0FF          96     					MOV		LCD,#0FFH	;On passe en mode Input (High Z)
00A5    C285            97     					CLR		RS
00A7    D286            98     					SETB		RW
                        99     RPT_BF: 				
00A9    C287           100     					CLR		E
00AB    D287           101     					SETB		E
00AD    20A7F9         102     JSQ_BF: 			JB			BF,RPT_BF
00B0    C287           103     					CLR		E
00B2    D0A0           104     					POP		LCD
00B4    22             105     FIN_LCD_BF: 		RET
                       106     
                       107     ;___________________________________________	
                       108     ;Routine d'attente de 50ms
                       109     ;Utilise le Timer0 en mode 1 (compteur 16 bits)
                       110     ;Modifie la valeur de C			
                       111     ATTENTE:  
00B5    C0E0           112     					PUSH		ACC			      
00B7    C28C           113     					CLR		TR0
00B9    E58A           114     					MOV		A,TL0					;1CM
00BB    24B8           115     ADD A , # 184 
00BD    F58A           116     		      	MOV		TL0,A					;1CM
00BF    E58C           117     			      MOV		A,TH0					;1CM
00C1    343C           118     ADDC A , # 60 
00C3    F58C           119     			      MOV		TH0,A					;1CM
00C5    C28D           120     		   	   CLR		TF0					;1CM
00C7    D28C           121     		      	SETB		TR0					;1CM
00C9    308DFD         122     ATTENDRE_TF0: 	JNB		TF0,ATTENDRE_TF0								
00CC    D0E0           123     					POP		ACC
00CE    22             124     FIN_ATTENTE: 	RET
                       125     
                       126     
                       127     					END
MACRO ASSEMBLER SECONDAIRE                                  12/04/19 19:55:04 PAGE     0


SYMBOL TABLE LISTING
------ ----- -------


N A M E             T Y P E  V A L U E   ATTRIBUTES             REFERENCES

ATTENDRE_TF0 . . .  C ADDR   00C9H   A                          122# 
P0 . . . . . . . .  D ADDR   0080H   A                          7 8 9 
P1 . . . . . . . .  D ADDR   0090H   A                          10 11 
FIN_LCD_INIT . . .  C ADDR   0072H   A                          56# 
P2 . . . . . . . .  D ADDR   00A0H   A                          5 6 
SP . . . . . . . .  D ADDR   0081H   A                          26 
E. . . . . . . . .  B ADDR   0080H.7 A                          9# 43 44 80 81 89 
                                                                90 100 101 103 
RS . . . . . . . .  B ADDR   0080H.5 A                          7# 40 78 87 97 
LCD_INIT . . . . .  C ADDR   0042H   A                          31 37# 
SIRENE . . . . . .  B ADDR   0090H.3 A                          11# 
ACC. . . . . . . .  D ADDR   00E0H   A                          61 71 112 123 
FIN_LCD_DATA . . .  C ADDR   009FH   A                          91# 
BF . . . . . . . .  B ADDR   00A0H.7 A                          6# 102 
FIN_LCD_CODE . . .  C ADDR   0093H   A                          82# 
RW . . . . . . . .  B ADDR   0080H.6 A                          8# 41 79 88 98 
TF0. . . . . . . .  B ADDR   0088H.5 A                          120 122 
TQ_MSG . . . . . .  C ADDR   0078H   A                          64# 70 
LCD_DATA . . . . .  C ADDR   0094H   A                          66 85# 
TH0. . . . . . . .  D ADDR   008CH   A                          117 119 
LCD_CODE . . . . .  C ADDR   0088H   A                          47 49 51 53 55 76# 
                                                                
TH1. . . . . . . .  D ADDR   008DH   A                          28 
TL0. . . . . . . .  D ADDR   008AH   A                          114 116 
FIN_ATTENTE. . . .  C ADDR   00CEH   A                          124# 
FTQ_MSG. . . . . .  C ADDR   0085H   A                          64 71# 
CHARGE_H . . . . .  N NUMB   003Ch                              15# 118 
JSQ_LCD_INIT . . .  C ADDR   0052H   A                          45# 
LCD. . . . . . . .  D ADDR   00A0H   A                          5# 42 46 48 50 52 
                                                                54 65 95 96 104 
SCON . . . . . . .  D ADDR   0098H   A                          29 
DEBUT. . . . . . .  C ADDR   0030H   A                          21 25# 
TMOD . . . . . . .  D ADDR   0089H   A                          27 
TCON . . . . . . .  D ADDR   0088H   A                          30 
JSQ_BF . . . . . .  C ADDR   00ADH   A                          102# 
ATTENTE. . . . . .  C ADDR   00B5H   A                          39 111# 
CHARGE_L . . . . .  N NUMB   00B8h                              16# 115 
FIN_LCD_BF . . . .  C ADDR   00B4H   A                          105# 
TR0. . . . . . . .  B ADDR   0088H.4 A                          113 121 
LASER. . . . . . .  B ADDR   0090H.2 A                          10# 
LCD_MSG. . . . . .  C ADDR   0073H   A                          60# 
LCD_BF . . . . . .  C ADDR   00A0H   A                          77 86 94# 
RPT_LCD_INIT . . .  C ADDR   0044H   A                          39# 45 
RPT_BF . . . . . .  C ADDR   00A9H   A                          99# 102 
FIN. . . . . . . .  C ADDR   0042H   A                          32# 



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    161    ----
   XDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


REGISTER BANK(S) USED : 0 

ASSEMBLY COMPLETE.   0 WARNING(S)   0 ERROR(S)
